<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Australia Chill Trip 2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/default.css">
    <script src="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/scroll-behaviour.min.js"></script>

    <style>
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .add-zone { opacity: 0; transition: all 0.2s ease; }
        .add-zone:hover { opacity: 1; height: 30px; }
        
        /* Visual cue when dragging */
        .is-dragging { 
            opacity: 0.4; 
            border: 2px dashed #3D9FBD; 
            background: #0f172a; 
        }

        /* CRITICAL: The Drag Handle Area */
        .drag-handle-area {
            touch-action: none; /* Stops iPhone from scrolling when touching this */
            cursor: grab;
            -webkit-touch-callout: none; /* Disables iOS magnifying glass */
            -webkit-user-select: none;
            user-select: none;
            padding: 10px; /* Bigger touch target */
            margin: -10px; /* Offset padding */
        }
        .drag-handle-area:active { cursor: grabbing; }

        input[type="time"]::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; }
        select { -webkit-appearance: none; -moz-appearance: none; appearance: none; text-align: center; }

        /* Polyfill Drag Image Styling */
        .dnd-poly-drag-image {
            opacity: 0.95 !important;
            background: #1e293b !important;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.6);
            padding: 12px;
            color: white;
            font-family: sans-serif;
            border: 2px solid #3D9FBD;
            transform: scale(1.05);
            width: 280px;
            z-index: 9999;
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-50 h-screen overflow-hidden">
    <div id="root" class="h-full"></div>

    <script>
        // --- Init Polyfill ---
        var MobileDragDrop = MobileDragDrop || {};
        MobileDragDrop.polyfill({
            dragImageTranslateOverride: MobileDragDrop.scrollBehaviourDragImageTranslateOverride,
            holdToDrag: 150 // Lower delay for faster response on handle
        });
        
        // Prevent default only when touching draggable elements to allow scrolling elsewhere
        window.addEventListener( 'touchmove', function() {}, {passive: false});
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Icons ---
        const Plane = ({ size = 16, className = "" }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 12h20"/><path d="M13 2l9 10-9 10"/><path d="M2 12l5-5m0 10l-5-5"/></svg>);
        const Camera = ({ size = 16, className = "" }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>);
        const Utensils = ({ size = 16, className = "" }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>);
        const Bed = ({ size = 16, className = "" }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M2 4v16"/><path d="M2 8h18a2 2 0 0 1 2 2v10"/><path d="M2 17h20"/><path d="M6 8v9"/></svg>);
        const MapPin = ({ size = 16, className = "" }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>);
        const ChevronUp = ({ size = 16, className = "" }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m18 15-6-6-6 6"/></svg>);
        const ImageIcon = ({ size = 16, className = "" }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>);
        const Plus = ({ size = 16, className = "" }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/><path d="M12 5v14"/></svg>);
        const Trash2 = ({ size = 16, className = "" }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>);
        // Larger Grip Icon
        const GripVertical = ({ size = 20, className = "" }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="9" cy="12" r="1"/><circle cx="9" cy="5" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="15" cy="19" r="1"/></svg>);
        const Check = ({ size = 16, className = "" }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 6 9 17 4 12"/></svg>);
        const Edit2 = ({ size = 16, className = "" }) => (<svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>);

        const LOCAL_STORAGE_KEY = "my-australia-trip-final";
        const PRIMARY_COLOR = "#3D9FBD";
        const DATE_TABS = [
            { label: "2/13", iso: "2026-02-13" }, { label: "2/14", iso: "2026-02-14" },
            { label: "2/15", iso: "2026-02-15" }, { label: "2/16", iso: "2026-02-16" },
            { label: "2/17", iso: "2026-02-17" }, { label: "2/18", iso: "2026-02-18" },
            { label: "2/19", iso: "2026-02-19" }, { label: "2/20", iso: "2026-02-20" },
            { label: "2/21", iso: "2026-02-21" }, { label: "2/22", iso: "2026-02-22" },
            { label: "2/23", iso: "2026-02-23" },
        ];

        const INITIAL_EVENTS = [
            { id: "e1", date: "2026-02-13", time: "13:30", title: "TPE ‚Üí MNL (CI 703)", type: "transport", location: "Taoyuan Airport T1", shortDescription: "Âá∫ÁôºÔºÅËèØËà™È£õÈ¶¨Â∞ºÊãâÔºåÊ∫ñÂÇôËΩâÊ©ü„ÄÇ" },
            { id: "e2", date: "2026-02-13", time: "21:10", title: "MNL ‚Üí MEL (PR 209)", type: "transport", location: "Manila T1", shortDescription: "Ëè≤ÂæãË≥ìËà™Á©∫ÈÅéÂ§úÁè≠Ê©üÔºåÊ©ü‰∏äË£úÁú†„ÄÇ" },
            { id: "e3", date: "2026-02-14", time: "08:30", title: "ÊäµÈÅîÂ¢®ÁàæÊú¨ & Âá∫Èóú", type: "transport", location: "Tullamarine Airport", shortDescription: "ÈÄöÈóúÁ¥Ñ 1hr„ÄÇÈ†òË°åÊùé„ÄÅË≤∑ SkyBus„ÄÇ" },
            { id: "e4", date: "2026-02-14", time: "10:30", title: "Queen Victoria Market", type: "food", location: "Melbourne CBD", shortDescription: "Â¢®ÁàæÊú¨ÊúÄÂ§ßÂ∏ÇÈõÜÔºåÂêÉÊó©ÂçàÈ§ê„ÄÇ", imageUrl: "https://images.unsplash.com/photo-1545465969-9c3dc1b61948?w=800", recommendedItems: ["Market Lane Coffee", "Bratwurst", "Doughnuts"] },
            { id: "e5", date: "2026-02-14", time: "14:00", title: "Fitzroy ÊñáÈùíÂçÄ", type: "activity", location: "Fitzroy", shortDescription: "Rose St. Market & Â°óÈ¥âÁâÜ„ÄÇ" },
            { id: "e6", date: "2026-02-14", time: "17:30", title: "St Kilda Êµ∑ÁÅò", type: "activity", location: "St Kilda", shortDescription: "Êê≠ Tram 96 ÂéªÊµ∑ÈÇäÁúãÂ§ïÈôΩ„ÄÇ", imageUrl: "https://images.unsplash.com/photo-1557404768-305896a24683?w=800" },
            { id: "e7", date: "2026-02-15", time: "08:30", title: "Lune Croissanterie", type: "food", location: "Fitzroy", shortDescription: "‰∏ñÁïåÊúÄÂ•ΩÂêÉÂèØÈ†åÔºåÈúÄÊéíÈöä„ÄÇ", imageUrl: "https://images.unsplash.com/photo-1527515637462-cff94eecc1ac?w=800", recommendedItems: ["Traditional", "Almond"] },
            { id: "e8", date: "2026-02-15", time: "10:30", title: "Melbourne Museum", type: "activity", location: "Carlton", shortDescription: "ÁöáÂÆ∂Â±ïË¶ΩÈ§® & ÊÅêÈæçÂçÄ„ÄÇ" },
            { id: "e9", date: "2026-02-15", time: "15:00", title: "Collingwood Yards", type: "activity", location: "Collingwood", shortDescription: "Áç®Á´ãÂ∞èÂ∫óËàá‰∏ãÂçàËå∂„ÄÇ" },
            { id: "e10", date: "2026-02-16", time: "10:00", title: "South Melbourne Market", type: "food", location: "South Melb", shortDescription: "ÂøÖÂêÉÁîüË†î„ÄÇ", recommendedItems: ["Dim Sims", "Oysters"] },
            { id: "e11", date: "2026-02-16", time: "14:00", title: "Yarra River & Southbank", type: "activity", location: "Southbank", shortDescription: "ÈõÖÊãâÊ≤≥Êï£Ê≠•„ÄÇ", imageUrl: "https://images.unsplash.com/photo-1514395462725-fb456621614d?w=800" },
            { id: "e12", date: "2026-02-17", time: "09:00", title: "ÂèñËªä & Âá∫ÁôºÂ§ßÊ¥ãË∑Ø", type: "transport", location: "City Rental", shortDescription: "Ê™¢Êü•ËªäÊ≥ÅÔºåÂâçÂæÄ Geelong„ÄÇ" },
            { id: "e13", date: "2026-02-17", time: "12:00", title: "Great Ocean Road Drive", type: "activity", location: "B100", shortDescription: "Memorial Arch, Lorne, Kennett River„ÄÇ", imageUrl: "https://images.unsplash.com/photo-1533293856238-d98a00632207?w=800" },
            { id: "e14", date: "2026-02-17", time: "17:00", title: "‰ΩèÂÆø Apollo Bay", type: "stay", location: "Apollo Bay", shortDescription: "Êµ∑ÈÇäÂ∞èÈéÆÊôöÈ§ê„ÄÇ" },
            { id: "e15", date: "2026-02-18", time: "06:30", title: "12 Apostles & Gibson", type: "activity", location: "Port Campbell", shortDescription: "Êó©Êô®ÈÅøÈñã‰∫∫ÊΩÆ„ÄÇ", imageUrl: "https://images.unsplash.com/photo-1498964893798-29241da62136?w=800" },
            { id: "e16", date: "2026-02-18", time: "09:00", title: "Loch Ard Gorge", type: "activity", location: "Port Campbell", shortDescription: "Ê≤àËàπÂ≥ΩË∞∑„ÄÇ" },
            { id: "e17", date: "2026-02-18", time: "14:00", title: "ÂâçÂæÄ Grampians", type: "transport", location: "Halls Gap", shortDescription: "ÂÖßÈô∏ËªäÁ®ã 2.5hr„ÄÇ" },
            { id: "e18", date: "2026-02-18", time: "17:00", title: "‰ΩèÂÆø Grampians View", type: "stay", location: "Halls Gap", shortDescription: "ÂÇçÊôöÁúãË¢ãÈº†„ÄÇ" },
            { id: "e19", date: "2026-02-19", time: "06:00", title: "Boroka Lookout Êó•Âá∫", type: "activity", location: "Grampians", shortDescription: "ÁµïÊôØËßÄÊôØÂè∞„ÄÇ", imageUrl: "https://images.unsplash.com/photo-1599827638593-38259f972b94?w=800" },
            { id: "e20", date: "2026-02-19", time: "09:00", title: "The Pinnacle Walk", type: "activity", location: "Wonderland", shortDescription: "Â≥ΩË∞∑Ê≠•ÈÅìÂÅ•Ë°å„ÄÇ" },
            { id: "e21", date: "2026-02-19", time: "14:00", title: "Mackenzie Falls", type: "activity", location: "Grampians", shortDescription: "Á∂≠Â∑ûÊúÄÂ§ßÁÄëÂ∏É„ÄÇ" },
            { id: "e22", date: "2026-02-20", time: "09:30", title: "Sovereign Hill", type: "activity", location: "Ballarat", shortDescription: "ÊéèÈáëÈéÆÈ´îÈ©ó„ÄÇ", imageUrl: "https://images.unsplash.com/photo-1579763740266-9b1682335606?w=800" },
            { id: "e23", date: "2026-02-20", time: "15:00", title: "ÂâçÂæÄ MEL Ê©üÂ†¥ÈÇÑËªä", type: "transport", location: "MEL Airport", shortDescription: "Âä†ÊªøÊ≤π„ÄÅÈÇÑËªä„ÄÇ" },
            { id: "e24", date: "2026-02-20", time: "18:00", title: "È£õÂæÄÂ∏ÉÈáåÊñØÊú¨/ÈªÉÈáëÊµ∑Â≤∏", type: "flight", location: "MEL ‚Üí BNE/OOL", shortDescription: "Êê≠‰πòÂúãÂÖßÁ∑ö„ÄÇ" },
            { id: "e25", date: "2026-02-21", time: "09:00", title: "Surfers Paradise", type: "activity", location: "Gold Coast", shortDescription: "Ë°ùÊµ™ËÄÖÂ§©Â†Ç„ÄÇ", imageUrl: "https://images.unsplash.com/photo-1506973035872-a4ec16b8e8d9?w=800" },
            { id: "e26", date: "2026-02-21", time: "14:00", title: "Burleigh Heads", type: "activity", location: "Gold Coast", shortDescription: "Áï∂Âú∞‰∫∫‰ºëÈñíÂçÄ„ÄÇ" },
            { id: "e27", date: "2026-02-22", time: "10:00", title: "Brisbane South Bank", type: "activity", location: "Brisbane", shortDescription: "‰∫∫Â∑•Ê≤ôÁÅò Streets Beach„ÄÇ" },
            { id: "e28", date: "2026-02-22", time: "13:00", title: "Lone Pine Koala", type: "activity", location: "Brisbane", shortDescription: "Êä±ÁÑ°Â∞æÁÜä (ÈÅ∏ÈÖç)„ÄÇ" },
            { id: "e29", date: "2026-02-23", time: "14:00", title: "ÊúÄÂæåÊé°Ë≤∑", type: "activity", location: "Queen St Mall", shortDescription: "Ë≤∑‰º¥ÊâãÁ¶Æ„ÄÇ" },
            { id: "e30", date: "2026-02-23", time: "22:15", title: "BNE ‚Üí TPE (BR 316)", type: "transport", location: "Brisbane Airport", shortDescription: "ÂõûÂÆ∂ÂõâÔºÅ", imageUrl: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?w=800" },
        ];

        const TravelTimelineApp = () => {
            const [selectedDate, setSelectedDate] = useState(DATE_TABS[0].iso);
            const [expandedEventId, setExpandedEventId] = useState(null);
            const [events, setEvents] = useState([]);
            const [draggedEventId, setDraggedEventId] = useState(null);
            const [editingId, setEditingId] = useState(null);
            const [processingImage, setProcessingImage] = useState(false);

            useEffect(() => {
                try {
                    const raw = localStorage.getItem(LOCAL_STORAGE_KEY);
                    setEvents(raw ? JSON.parse(raw) : INITIAL_EVENTS);
                } catch (e) { setEvents(INITIAL_EVENTS); }
            }, []);

            useEffect(() => {
                if (events.length > 0) {
                    try {
                        localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(events));
                    } catch (e) { console.error("Storage full", e); }
                }
            }, [events]);

            const now = new Date();
            const eventsForSelectedDate = useMemo(() => 
                events.filter(e => e.date === selectedDate), 
            [events, selectedDate]);

            // --- Handlers ---
            const handleToggleChecked = (id) => setEvents(prev => prev.map(ev => ev.id === id ? { ...ev, isCompleted: !ev.isCompleted } : ev));
            const handleNoteChange = (id, text) => setEvents(prev => prev.map(ev => ev.id === id ? { ...ev, userNotes: text } : ev));
            
            const handleImageUpload = (id, e) => {
                const file = e.target.files[0];
                if (!file) return;
                setProcessingImage(true);
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const MAX_WIDTH = 800; const MAX_HEIGHT = 800;
                        let width = img.width; let height = img.height;
                        if (width > height) { if (width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; } } 
                        else { if (height > MAX_HEIGHT) { width *= MAX_HEIGHT / height; height = MAX_HEIGHT; } }
                        canvas.width = width; canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        const compressedBase64 = canvas.toDataURL('image/jpeg', 0.7);
                        setEvents(prev => prev.map(ev => ev.id === id ? { ...ev, images: [...(ev.images || []), compressedBase64] } : ev));
                        setProcessingImage(false);
                    };
                };
            };

            const handleDeleteEvent = (id) => { if(confirm("Delete this event?")) setEvents(prev => prev.filter(ev => ev.id !== id)); };
            const handleUpdateField = (id, field, value) => { setEvents(prev => prev.map(ev => ev.id === id ? { ...ev, [field]: value } : ev)); };

            // --- Drag Handlers (The Handle-Only Logic) ---
            const handleDragStart = (e, id) => { 
                setDraggedEventId(id); 
                e.dataTransfer.effectAllowed = "move"; 
                e.dataTransfer.setData("text/plain", id);
                // Fix for iOS Polyfill drag image offset
                if (window.MobileDragDrop) {
                    e.dataTransfer.setDragImage(e.target.closest('.group'), 0, 0); 
                }
            };
            
            const handleDragOver = (e) => { 
                e.preventDefault(); 
                e.dataTransfer.dropEffect = "move";
            };
            
            const handleDragEnter = (e) => { e.preventDefault(); };
            
            const handleDragEnd = () => { setDraggedEventId(null); };

            const handleDrop = (e, targetId) => {
                e.preventDefault();
                const draggedId = draggedEventId;
                setDraggedEventId(null); // Clear state immediately

                if (!draggedId || draggedId === targetId) return;
                
                const currentList = events.filter(e => e.date === selectedDate);
                const fromIndex = currentList.findIndex(e => e.id === draggedId);
                const toIndex = currentList.findIndex(e => e.id === targetId);
                
                if (fromIndex === -1 || toIndex === -1) return;

                const newList = [...currentList];
                const [moved] = newList.splice(fromIndex, 1);
                newList.splice(toIndex, 0, moved);
                
                const otherDaysEvents = events.filter(e => e.date !== selectedDate);
                setEvents([...otherDaysEvents, ...newList]);
            };

            const handleAddEvent = (indexToInsert = -1) => {
                const newId = `new-${Date.now()}`;
                const newEvent = { id: newId, date: selectedDate, time: "12:00", title: "", type: "activity", location: "", shortDescription: "New item", isCompleted: false, images: [] };
                const currentList = events.filter(e => e.date === selectedDate);
                const otherDaysEvents = events.filter(e => e.date !== selectedDate);
                let newCurrentList = [...currentList];
                if (indexToInsert === -1) newCurrentList.push(newEvent); else newCurrentList.splice(indexToInsert, 0, newEvent);
                setEvents([...otherDaysEvents, ...newCurrentList]);
                setEditingId(newId);
            };

            const getCategoryIcon = (type) => {
                if (type === 'transport') return <Plane className="text-blue-400" />;
                if (type === 'food') return <Utensils className="text-orange-400" />;
                if (type === 'stay') return <Bed className="text-purple-400" />;
                if (type === 'activity') return <Camera className="text-emerald-400" />;
                return <MapPin className="text-slate-400" />;
            };
            const typeLabels = { transport: "‰∫§ÈÄö", activity: "Ë°åÁ®ã", food: "ÁæéÈ£ü", stay: "‰ΩèÂÆø" };

            const AddZone = ({ index }) => (
                <div className="add-zone h-2 w-full flex items-center justify-center cursor-pointer group my-1 relative z-10" onClick={() => handleAddEvent(index)}>
                    <div className="w-full h-px bg-slate-800 group-hover:bg-blue-500/50 transition-colors relative"></div>
                    <div className="absolute bg-slate-900 border border-blue-500/50 text-blue-400 text-[10px] px-3 py-1 rounded-full opacity-0 group-hover:opacity-100 transition-all transform scale-90 group-hover:scale-100 flex items-center gap-1 shadow-lg shadow-blue-900/20"><Plus size={12} /> Insert</div>
                </div>
            );

            return (
                <div className="flex flex-col h-full bg-slate-950 text-slate-50 font-sans">
                    <header className="shrink-0 bg-slate-950/80 backdrop-blur border-b border-slate-800 p-4 pb-0 z-20">
                        <div className="flex justify-between items-center mb-3">
                            <div><div className="text-[10px] tracking-widest text-slate-400 font-bold uppercase">2026 Trip Planner</div><h1 className="text-lg font-bold">Australia <span style={{color:PRIMARY_COLOR}}>Chill Trip</span></h1></div>
                            <div className="text-xs text-slate-400">{now.toLocaleDateString()}</div>
                        </div>
                        <div className="flex gap-2 overflow-x-auto pb-3 hide-scrollbar">
                            {DATE_TABS.map(d => (
                                <button key={d.iso} onClick={() => setSelectedDate(d.iso)} className={`shrink-0 px-4 py-2 rounded-full text-xs font-bold border transition-all ${selectedDate === d.iso ? "text-slate-950 border-transparent scale-105" : "border-slate-800 text-slate-400"}`} style={{background: selectedDate === d.iso ? `linear-gradient(135deg, ${PRIMARY_COLOR}, ${PRIMARY_COLOR}dd)` : 'rgba(30,41,59,0.5)'}}>
                                    {d.label}
                                </button>
                            ))}
                        </div>
                    </header>
                    <main className="flex-1 overflow-y-auto p-4 pb-20">
                        <div className="bg-slate-900/50 border border-slate-800 rounded-2xl p-4 space-y-0 backdrop-blur-sm min-h-[300px]">
                            {eventsForSelectedDate.length === 0 && <div className="text-center py-10"><div className="text-slate-500 mb-2">No events today. üåø</div><button onClick={() => handleAddEvent(-1)} className="text-xs bg-slate-800 hover:bg-slate-700 px-3 py-1.5 rounded-lg text-slate-300 transition-colors">+ Add First Event</button></div>}
                            
                            {eventsForSelectedDate.length > 0 && <AddZone index={0} />}

                            {eventsForSelectedDate.map((ev, i) => {
                                const isCurrent = new Date(`${ev.date}T${ev.time}`).getTime() - now.getTime() < 3600000 && new Date(`${ev.date}T${ev.time}`).getTime() > now.getTime();
                                const isExpanded = expandedEventId === ev.id;
                                const isChecked = ev.isCompleted; 
                                const isDragging = draggedEventId === ev.id;
                                const isEditing = editingId === ev.id;

                                return (
                                    <React.Fragment key={ev.id}>
                                        <div 
                                            className={`flex gap-3 group relative transition-opacity duration-200 ${isDragging ? "is-dragging rounded-xl" : ""}`}
                                            // 1. Remove draggable from here to stop scroll conflict
                                            onDragOver={handleDragOver}
                                            onDragEnter={handleDragEnter}
                                            onDrop={(e) => handleDrop(e, ev.id)}
                                        >
                                            {/* 2. Drag Handle is the ONLY draggable element */}
                                            <div 
                                                className="absolute -left-4 top-4 opacity-50 group-hover:opacity-100 drag-handle-area"
                                                draggable={!isEditing}
                                                onDragStart={(e) => handleDragStart(e, ev.id)}
                                                onDragEnd={handleDragEnd}
                                            >
                                                <GripVertical size={18} className="text-slate-500 hover:text-white"/>
                                            </div>

                                            <div className="flex flex-col items-center mt-1 relative">
                                                <div className={`w-3 h-3 rounded-full border-[2px] z-10 ${isCurrent ? `bg-[${PRIMARY_COLOR}] border-[${PRIMARY_COLOR}] shadow-[0_0_10px_${PRIMARY_COLOR}]` : isChecked ? "bg-emerald-500 border-emerald-500" : `bg-slate-950 border-[${PRIMARY_COLOR}]`}`}></div>
                                                <div className="w-px flex-1 bg-slate-800 my-1 group-hover:bg-slate-700 absolute top-3 bottom-[-20px]"></div>
                                            </div>

                                            <div className={`flex-1 border rounded-xl overflow-hidden transition-all relative ${isChecked ? "opacity-60 grayscale" : "bg-slate-900/80"} ${isCurrent ? `ring-1 ring-[${PRIMARY_COLOR}] shadow-lg` : "border-slate-700"}`} onClick={() => !isEditing && setExpandedEventId(isExpanded ? null : ev.id)}>
                                                <div className="p-3 pr-10">
                                                    <div className="flex justify-between items-start gap-3">
                                                        <div className="min-w-0 flex-1">
                                                            <div className="flex items-center gap-2 mb-1">
                                                                {isEditing ? (
                                                                    <input type="time" className="text-xs bg-slate-800 text-white border border-blue-500/50 rounded px-1 py-0 outline-none" value={ev.time} onClick={(e) => e.stopPropagation()} onChange={(e) => handleUpdateField(ev.id, 'time', e.target.value)} />
                                                                ) : (
                                                                    <span className={`font-mono text-xs cursor-pointer hover:text-blue-400 hover:underline decoration-dashed transition-colors ${isCurrent ? `text-[${PRIMARY_COLOR}] font-bold` : "text-slate-400"}`} onClick={(e) => { e.stopPropagation(); setEditingId(ev.id); }} title="Click to Edit">{ev.time}</span>
                                                                )}
                                                                {isEditing ? (
                                                                    <select className="text-[10px] bg-slate-800 border border-blue-500/50 rounded px-1 py-0 outline-none text-slate-300 ml-2" value={ev.type} onClick={(e) => e.stopPropagation()} onChange={(e) => handleUpdateField(ev.id, 'type', e.target.value)}>
                                                                        <option value="transport">‰∫§ÈÄö</option><option value="activity">Ë°åÁ®ã</option><option value="food">ÁæéÈ£ü</option><option value="stay">‰ΩèÂÆø</option>
                                                                    </select>
                                                                ) : (
                                                                    <span className="text-[10px] px-1.5 rounded border border-slate-700 text-slate-400 ml-2">{typeLabels[ev.type]}</span>
                                                                )}
                                                            </div>
                                                            {isEditing ? (
                                                                <div className="flex items-center gap-2 mt-1" onClick={e => e.stopPropagation()}>
                                                                    <input type="text" className="bg-slate-800 border border-blue-500/50 rounded px-2 py-1 text-sm font-bold text-white w-full outline-none focus:ring-1 focus:ring-blue-500" value={ev.title} placeholder="Event Title..." autoFocus onChange={(e) => handleUpdateField(ev.id, 'title', e.target.value)} onKeyDown={(e) => e.key === 'Enter' && setEditingId(null)} />
                                                                    <button onClick={() => setEditingId(null)} className="bg-emerald-600/20 text-emerald-500 border border-emerald-600/50 p-1 rounded hover:bg-emerald-600 hover:text-white transition-colors"><Check size={16} /></button>
                                                                </div>
                                                            ) : (
                                                                <h3 className="font-semibold truncate flex items-center gap-2 text-slate-100"><span className="opacity-90 shrink-0">{getCategoryIcon(ev.type)}</span><span className="truncate" onClick={(e) => { e.stopPropagation(); setEditingId(ev.id); }}>{ev.title}</span><button onClick={(e) => { e.stopPropagation(); setEditingId(ev.id); }} className="opacity-0 group-hover:opacity-50 hover:!opacity-100 text-slate-500 transition-opacity ml-1"><Edit2 size={12} /></button></h3>
                                                            )}
                                                            {ev.location && !isEditing && <div className="text-xs text-slate-400 mt-1 flex items-center gap-1"><MapPin size={12}/> {ev.location}</div>}
                                                        </div>
                                                    </div>
                                                    {!isEditing && <p className="text-xs text-slate-300 mt-2 line-clamp-2">{ev.shortDescription}</p>}
                                                    <div className="absolute top-3 right-3 flex flex-col gap-2" onClick={e => e.stopPropagation()}>
                                                        <button onClick={() => handleToggleChecked(ev.id)} className={`w-8 h-8 rounded-full border flex items-center justify-center shrink-0 transition-all ${isChecked ? "bg-emerald-500/20 border-emerald-500 text-emerald-500" : "border-slate-700 text-slate-600 hover:bg-slate-800"}`}>{isChecked && "‚úì"}</button>
                                                        <button onClick={() => handleDeleteEvent(ev.id)} className="w-8 h-8 rounded-full border border-slate-700 text-slate-500 flex items-center justify-center hover:bg-red-500/20 hover:border-red-500 hover:text-red-500 transition-all"><Trash2 size={14} /></button>
                                                    </div>
                                                </div>
                                                {isExpanded && !isEditing && <div className="bg-slate-950/50 border-t border-slate-800 p-3 space-y-3 animate-in slide-in-from-top-2">
                                                    <textarea onClick={e=>e.stopPropagation()} value={ev.userNotes || ""} onChange={e=> handleNoteChange(ev.id, e.target.value)} className="w-full bg-slate-900 border border-slate-700 rounded-lg text-xs p-2 text-slate-200 focus:outline-none focus:border-[color:#3D9FBD]" placeholder="Notes..." rows={2}></textarea>
                                                    {ev.imageUrl && <img src={ev.imageUrl} className="w-full h-32 object-cover rounded-lg border border-slate-700" />}
                                                    {ev.images?.map((src,k)=><img key={k} src={src} className="w-full h-24 object-cover rounded-lg border border-slate-700"/>)}
                                                    <label onClick={e=>e.stopPropagation()} className="block w-full py-2 border border-dashed border-slate-600 rounded-lg text-center text-xs text-slate-400 cursor-pointer hover:bg-slate-800"><span className="flex items-center justify-center gap-2"><ImageIcon size={14}/> {processingImage ? "Compressing..." : "Add Photo"}</span><input type="file" accept="image/*" className="hidden" onChange={(e) => handleImageUpload(ev.id, e)}/></label>
                                                    <div className="flex justify-center"><ChevronUp size={16} className="text-slate-600"/></div>
                                                </div>}
                                            </div>
                                        </div>
                                        <AddZone index={i + 1} />
                                    </React.Fragment>
                                );
                            })}
                        </div>
                    </main>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TravelTimelineApp />);
    </script>
</body>
</html>